<div id="past_info"></div>

<script>

    //past events
    
    (function () {
    
        var app = "https://script.google.com/macros/s/AKfycby5wIU62Fm_FogxKaIulUoCeeVsiYnfrsDwR1uxr5UQoAoZq120tGfVsNvYG6MJJyWQ/exec";
        var output = document.getElementById('past_info');
        var xhr = new XMLHttpRequest();
    
        var card_month = ["января", "февраля", "марта", "апреля", "мая", "июня", "июля", "августа", "сентября", "октября", "ноября", "декабря"];
        var head_month = ["январь", "февраль", "март", "апрель", "май", "июнь", "июль", "август", "сентябрь", "октябрь", "ноябрь", "декабрь"];
        var month_num = '';
        
    
        xhr.open('GET', app);
        xhr.onreadystatechange = function() {
         if (xhr.readyState !== 4) return;
    
         if (xhr.status == 200) {
            try {
                var r = JSON.parse(xhr.responseText),
                   result = r["calendar"];
                for (var i = 0; i < result.length; i++){
                      var obj = r["calendar"][i];
                      
                      var s_date = obj[0].split('-'); //в массив s_date (start date) записываются год, месяц и день начала мероприятия
                      if (obj[2] != '')  { //если есть вторая дата
                          var e_date = obj[2].split('-'); //в массив e_date (end date) записываются год, месяц и день конца мероприятия
                      }
                      if (obj[1] != '') {
                          var s_time = obj[1]; //в переменную s_time (start time) записываются время начала мероприятия
                      }
                      if (obj[3] != '') {
                          var e_time = obj[3]; //в переменную e_time (end time) записываются время конца мероприятия
                      }
    
    
    
                      if (s_date[1] != month_num) { //если номер месяца не совпадает с номером месяца предыдущего события, добавляем название месяца и года перед карточкой
                          month_num = s_date[1];
                          var h_month = document.createElement('div'); 
                          h_month.setAttribute('class', 'h_month');
                          h_month.textContent = head_month[s_date[1]-1] +' '+ s_date[0];
                          output.appendChild(h_month);
                      }
                    
                      var c_card = document.createElement('div');
                      c_card.setAttribute('id', obj[0] + 'T' + obj[1]);
                      c_card.setAttribute('class', 'c_card');
                      output.appendChild(c_card);

                    

                      var c_about = document.createElement('div');
                      c_about.setAttribute('class', 'c_about');
                      c_about.textContent = obj[6].replace(/&nbsp;|#nbsp;/gi, '\u00A0');  // неразрывный пробел
                      c_card.appendChild(c_about); //описание - идет первым, потому что у нее position relative
                    
                      var c_day = document.createElement('div');
                      if ((obj[2] == '') && (obj[2] != obj[0])) {
                        c_day.setAttribute('class', 'c_day');
                        c_day.textContent = s_date[2]; //если нет конечной дат или она совпадает с начальной (событие на один день) пишем одно число месяца
                      } else {
                        c_day.setAttribute('class', 'c_days');
                        c_day.textContent = s_date[2] + ' – ' + e_date[2]; //если есть вторая дата, пишем обе через короткое тире
                      }
                      c_card.appendChild(c_day);

                      var c_month = document.createElement('div');
                      c_month.setAttribute('class', 'c_month');
                      c_month.textContent = card_month[s_date[1]-1]; // название месяца из массива, 1 вычитается потому, что массив начинается с 0. Диапазон месяцев пока не придумал как писать
                      c_card.appendChild (c_month);

                      var c_time = document.createElement('div');
                      c_time.setAttribute('class', 'c_time');
                      if (obj[3] == '') {
                        c_time.textContent = obj[1];
                      } else {
                        c_time.textContent = obj[1] + ' – ' + obj[3];
                      }
                      c_card.appendChild(c_time);
                    
                      var c_type = document.createElement('div');
                      c_type.setAttribute('class', 'c_type');
                      c_type.textContent = obj[5];
                      c_card.appendChild(c_type);

                      var c_placetag = document.createElement('div');
                      c_placetag.setAttribute('class', 'c_placetag');
                      c_placetag.textContent = 'Место';
                      c_card.appendChild(c_placetag);

                      var c_place = document.createElement('div');
                      c_place.setAttribute('class', 'c_place');
                      c_place.textContent = obj[7].replace(/&nbsp;|#nbsp;/gi, '\u00A0');  // неразрывный пробел;
                      c_card.appendChild(c_place);

                      if (obj[8] != '') {
                          var c_link = document.createElement('div');
                          var a_link = document.createElement('a');
                          var a_linkText = document.createTextNode('Описание');

                          a_link.target = '_blank';
                          a_link.href = obj[8];

                          a_link.appendChild(a_linkText);
                          c_link.appendChild(a_link);
                          c_link.setAttribute('class', 'c_link');
                          c_card.appendChild(c_link);
                      }

                }
            } catch(e)  {/*console.error(e, e.stack);*/}
         }     
       }
       xhr.send()
    })()
    
    </script>
    
    
